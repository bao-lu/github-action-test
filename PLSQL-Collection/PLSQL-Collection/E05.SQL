SET SQLPROMPT "";
SET SQLNUMBER OFF;


CONNECT SYSTEM/SYSTEM;

DROP USER E05 CASCADE;
CREATE USER E05 IDENTIFIED BY "E05";
GRANT CONNECT,RESOURCE TO E05;


CONNECT E05/E05;

CREATE TABLE CLIENTE
(
  COD_CLIENTE CHAR(4)      CONSTRAINT PK_CLIENTE PRIMARY KEY,
  DNI         CHAR(9)      CONSTRAINT UQ_DNI UNIQUE,
  NOMBRE      VARCHAR2(40) CONSTRAINT NN_NOMBRE NOT NULL,
  DIRECCION   VARCHAR2(40),
  TELEFONO    CHAR(9)
);


CREATE TABLE COCHE
(
  MATRICULA  CHAR(7)      CONSTRAINT PK_COCHE PRIMARY KEY,
  MARCA      VARCHAR2(20) CONSTRAINT NN_MARCA NOT NULL,
  MODELO     VARCHAR2(20) CONSTRAINT NN_MODELO NOT NULL,
  COLOR      VARCHAR2(20),
  PRECIOHORA NUMBER
);


CREATE TABLE RESERVA
(
  NUMERO      NUMBER(4) CONSTRAINT PK_RESERVA PRIMARY KEY,
  FECHAINICIO DATE,
  FECHAFIN    DATE,
  PRECIOTOTAL NUMBER,
  CODCLIENTE  CHAR(4)   CONSTRAINT FK_RESERVA 
    REFERENCES CLIENTE(COD_CLIENTE)
);


CREATE SEQUENCE NUMERORESERVA;


CREATE TABLE AVALA
(
   AVALADO  CHAR(4),
   AVALADOR CHAR(4),
   CONSTRAINT PK_AVALA PRIMARY KEY (AVALADO),
   CONSTRAINT FK1_AVALA FOREIGN KEY(AVALADO) 
     REFERENCES CLIENTE(COD_CLIENTE),
   CONSTRAINT FK2_AVALA FOREIGN KEY(AVALADOR)
     REFERENCES CLIENTE(COD_CLIENTE)
);


CREATE TABLE INCLUYE
(
  NUMERO    NUMBER(4),
  MATRICULA CHAR(7),
  LITROSGAS NUMBER,
  CONSTRAINT PK_INCLUYE PRIMARY KEY (NUMERO, MATRICULA),
  CONSTRAINT FK1_INCLUYE FOREIGN KEY (NUMERO) 
    REFERENCES RESERVA(NUMERO),
  CONSTRAINT FK2_INCLUYE FOREIGN KEY (MATRICULA) 
    REFERENCES COCHE(MATRICULA)
);

ARCA NOT NULL,
  MODELO     VARCHAR2(20) CONSTRAINT NN_MODELO NOT NULL,
  COLOR      VARCHAR2(20),
  PRECIOHORA NUMBER
);


CREATE TABLE RESERVA
(
  NUMERO      NUMBER(4) CONSTRAINT PK_RESERVA PRIMARY KEY,
  FECHAINICIO DATE,
  FECHAFIN    DATE,
  PRECIOTOTAL NUMBER,
  CODCLIENTE  CHAR(4)   CONSTRAINT FK_RESERVA 
    REFERENCES CLIENTE(COD_CLIENTE)
);


CREATE SEQUENCE NUMERORESERVA;


CREATE TABLE AVALA
(
   AVALADO  CHAR(4)